

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Create database &mdash; pyphoon documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="pyphoon documentation" href="../index.html"/>
        <link rel="up" title="Examples" href="../examples.html"/>
        <link rel="next" title="FAQs" href="../faqs.html"/>
        <link rel="prev" title="Correcting image data" href="correct_image.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/pyphoon_logo_large.png" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../home.html">Home</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../environment.html">Development environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data.html">Data</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="best_eda.html">Best Track EDA</a></li>
<li class="toctree-l2"><a class="reference internal" href="typhoon_sequence.html">Working with a typhoon sequence</a></li>
<li class="toctree-l2"><a class="reference internal" href="correct_image.html">Correcting image data</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Create database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#original-image-data">Original image data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#best-track-data">Best track data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#corrected-image-data">Corrected image data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#define-fix-algorithm">Define Fix Algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#generate-new-dataset">Generate new dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-new-dataset-info-to-pdmanager">Add new dataset info to PDManager</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faqs.html">FAQs</a></li>
</ul>
<p class="caption"><span class="caption-text">Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../projects/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/tcxtc.html">tcxtc</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pyphoon.io.html">pyphoon.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyphoon.clean_satellite.html">pyphoon.clean_satellite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyphoon.db.html">pyphoon.db</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyphoon.app.html">pyphoon.app</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyphoon.visualise.html">pyphoon.visualise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyphoon.eda_jma.html">pyphoon.eda_jma</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyphoon</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../examples.html">Examples</a> &raquo;</li>
        
      <li>Create database</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
    
        <div class="section" id="create-database">
<h1>Create database<a class="headerlink" href="#create-database" title="Permalink to this headline">¶</a></h1>
<p>For our needs, we created a batch of tools to generate an easy interaction
with the Digital Typhoon data. In particular, we exploited the functionality
of pandas.DataFrame objects to track which images have been corrected and
other relevant image features. The core interface here is <code class="xref py py-class docutils literal notranslate"><span class="pre">PDManager</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyphoon.db</span> <span class="k">import</span> <span class="n">pd_manager</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pd_man</span> <span class="o">=</span> <span class="n">pd_manager</span><span class="o">.</span><span class="n">PDManager</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="original-image-data">
<h2>Original image data<a class="headerlink" href="#original-image-data" title="Permalink to this headline">¶</a></h2>
<p>Assuming that <code class="docutils literal notranslate"><span class="pre">orig_images_dir</span></code> is a string containing the path to the
original source images (as explained in section <a class="reference external" href="data.html">Data</a>), you can
load them using the method <code class="xref py py-func docutils literal notranslate"><span class="pre">add_orig_images()</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd_man</span><span class="o">.</span><span class="n">add_original_images</span><span class="p">(</span><span class="n">orig_images_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>This method creates an internal DataFrame representation of the original
image data. You may have a look at as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd_man</span><span class="o">.</span><span class="n">original_images</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Furthermore, you may want to save this table as a pickle file in
<code class="docutils literal notranslate"><span class="pre">images_pkl_path</span></code> using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd_man</span><span class="o">.</span><span class="n">pkl_save_original_images</span><span class="p">(</span><span class="n">images_pkl_path</span><span class="p">)</span>
</pre></div>
</div>
<p>In subsequent executions, you can load this table by using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd_man</span><span class="o">.</span><span class="n">pkl_load_original_images</span><span class="p">(</span><span class="n">images_pkl_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="best-track-data">
<h2>Best track data<a class="headerlink" href="#best-track-data" title="Permalink to this headline">¶</a></h2>
<p>Assuming that <code class="docutils literal notranslate"><span class="pre">besttrack_dir</span></code> is a string containing the path to the
best track data (as explained in section <a class="reference external" href="data.html">Data</a>), you can
load this data using the method <code class="xref py py-func docutils literal notranslate"><span class="pre">add_besttrack()</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd_man</span><span class="o">.</span><span class="n">add_besttrack</span><span class="p">(</span><span class="n">besttrack_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>This method creates an internal DataFrame representation of the best track
data. You may have a look at as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd_man</span><span class="o">.</span><span class="n">besttrack</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Furthermore, you may want to save this table as a pickle file in
<code class="docutils literal notranslate"><span class="pre">besttrack_pkl_path</span></code> using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd_man</span><span class="o">.</span><span class="n">pkl_save_besttrack</span><span class="p">(</span><span class="n">besttrack_pkl_path</span><span class="p">)</span>
</pre></div>
</div>
<p>In subsequent executions, you can load this table by using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd_man</span><span class="o">.</span><span class="n">pkl_load_besttrack</span><span class="p">(</span><span class="n">besttrack_pkl_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="corrected-image-data">
<h2>Corrected image data<a class="headerlink" href="#corrected-image-data" title="Permalink to this headline">¶</a></h2>
<p>To include corrupted image data in <code class="xref py py-class docutils literal notranslate"><span class="pre">PDManager</span></code>
you need to first generate the dataset of the corrected versions of the
originally corrupted images. To do so, you need to refer to method
<code class="xref py py-func docutils literal notranslate"><span class="pre">generate_new_image_dataset()</span></code>.</p>
<div class="section" id="define-fix-algorithm">
<h3>Define Fix Algorithm<a class="headerlink" href="#define-fix-algorithm" title="Permalink to this headline">¶</a></h3>
<p>As pointed out in <a class="reference external" href="data.html">Data</a>, we first need to define the fixing
algorithm</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyphoon.clean_satellite.correction</span> <span class="k">import</span> <span class="n">correct_corrupted_pixels_1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyphoon.clean_satellite.detection</span> <span class="k">import</span> <span class="n">detect_corrupted_pixels_1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyphoon.clean_satellite.generation</span> <span class="k">import</span> <span class="n">generate_new_frames_1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyphoon.clean_satellite.fix</span> <span class="k">import</span> <span class="n">TyphoonListImageFixAlgorithm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define Fixing algorithm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fix_algorithm</span> <span class="o">=</span> <span class="n">TyphoonListImageFixAlgorithm</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">detect_fct</span><span class="o">=</span><span class="n">detect_corrupted_pixels_1</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">correct_fct</span><span class="o">=</span><span class="n">correct_corrupted_pixels_1</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">detect_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;min_th&#39;</span><span class="p">:</span> <span class="mi">160</span><span class="p">,</span> <span class="s1">&#39;max_th&#39;</span><span class="p">:</span> <span class="mi">310</span><span class="p">},</span>
<span class="gp">... </span>   <span class="n">n_frames_th</span><span class="o">=</span><span class="mi">2</span>
<span class="go">...)</span>
</pre></div>
</div>
</div>
<div class="section" id="generate-new-dataset">
<h3>Generate new dataset<a class="headerlink" href="#generate-new-dataset" title="Permalink to this headline">¶</a></h3>
<p>Once the algorithm is defined, let us apply generate the new dataset using
method <a class="reference internal" href="../pyphoon.db.html#pyphoon.clean_satellite.fix.generate_new_image_dataset" title="pyphoon.clean_satellite.fix.generate_new_image_dataset"><code class="xref py py-func docutils literal notranslate"><span class="pre">generate_new_image_dataset()</span></code></a>. Replace
<code class="docutils literal notranslate"><span class="pre">images_orig_dir</span></code> with the directory of original images and
<code class="docutils literal notranslate"><span class="pre">images_corrected_dir</span></code> with the directory for the new corrected data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyphoon.clean_satellite.fix</span> <span class="k">import</span> <span class="n">generate_corrected_image_dataset</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generate_new_image_dataset</span><span class="p">(</span><span class="n">images_orig_dir</span><span class="o">=</span><span class="n">images_orig_dir</span><span class="p">,</span>
<span class="gp">... </span>                           <span class="n">fix_algorithm</span><span class="o">=</span><span class="n">fix_algorithm</span><span class="p">,</span>
<span class="gp">... </span>                           <span class="n">images_corrected_dir</span><span class="o">=</span><span class="n">images_corrected_dir</span><span class="p">,</span>
<span class="gp">... </span>                           <span class="n">display</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span>                           <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="add-new-dataset-info-to-pdmanager">
<h3>Add new dataset info to PDManager<a class="headerlink" href="#add-new-dataset-info-to-pdmanager" title="Permalink to this headline">¶</a></h3>
<p>Once the dataset is created, its information can be easily imported to
<code class="docutils literal notranslate"><span class="pre">pd_man</span></code> as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd_man</span><span class="o">.</span><span class="n">add_corrupted_images</span><span class="p">(</span><span class="n">images_dir</span><span class="o">=</span><span class="n">corrected_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>Like other table fields, you can save the table using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pkl_save_corrupted_images</span><span class="p">(</span><span class="n">corrupted_pkl_path</span><span class="p">)</span>
</pre></div>
</div>
<p>and load</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pkl_load_corrupted_images</span><span class="p">(</span><span class="n">corrupted_pkl_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>

    

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../faqs.html" class="btn btn-neutral float-right" title="FAQs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="correct_image.html" class="btn btn-neutral" title="Correcting image data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Kitamoto Lab interns.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2018a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>