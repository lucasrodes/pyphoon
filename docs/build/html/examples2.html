

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Examples &mdash; pyphoon documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.png"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="pyphoon documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html">
          

          
            
            <img src="_static/pyphoon_logo_large.png" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="home.html">Home</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Development environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="faqs.html">FAQs</a></li>
</ul>
<p class="caption"><span class="caption-text">Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="projects/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects/tcxtc.html">tcxtc</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pyphoon.io.html">pyphoon.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyphoon.clean_satellite.html">pyphoon.clean_satellite</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyphoon.db.html">pyphoon.db</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyphoon.app.html">pyphoon.app</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyphoon.visualise.html">pyphoon.visualise</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyphoon.eda_jma.html">pyphoon.eda_jma</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyphoon</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
    
        <div class="section" id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<p>Here we present some examples using the tools from the library. You can find
these examples <a class="reference external" href="https://github.com/lucasrodes/pyphoon/tree/master/scripts">here</a>.</p>
<p><strong>Contents:</strong></p>
<div class="line-block">
<div class="line"><a class="reference internal" href="#integrating-the-data"><span class="std std-ref">1. Integrating the data</span></a></div>
<div class="line-block">
<div class="line"><a class="reference internal" href="#generate-a-typhoonsequence-hdf-file"><span class="std std-ref">1.1 Generate a TyphoonSequence HDF File</span></a></div>
</div>
<div class="line"><a class="reference internal" href="#dataset-overview"><span class="std std-ref">2. Dataset overview</span></a></div>
<div class="line-block">
<div class="line"><a class="reference internal" href="#mean-image"><span class="std std-ref">2.1 Mean image</span></a></div>
<div class="line"><a class="reference internal" href="#visualize-a-typhoonsequence"><span class="std std-ref">2.2 Visualize a TyphoonList</span></a></div>
</div>
<div class="line"><a class="reference internal" href="#corrupted-files"><span class="std std-ref">3. Corrupted files</span></a></div>
<div class="line-block">
<div class="line"><a class="reference internal" href="#corrupted-images"><span class="std std-ref">3.1 Corrupted images</span></a></div>
</div>
</div>
<div class="section" id="integrating-the-data">
<span id="id1"></span><h2>1. Integrating the data<a class="headerlink" href="#integrating-the-data" title="Permalink to this headline">¶</a></h2>
<p>The Digital Typhoon data is build from two main sources:</p>
<ul class="simple">
<li><strong>Satellite imagery:</strong> Images of typhoons taken from several geostationary satellites since 1978.</li>
<li><strong>Best Track:</strong> Several parameters of typhoons.</li>
</ul>
<p>Both components originally come in two different formats. All images
belonging to the a certain typhoon sequence are stored as HDF files under
the same folder. The best track data comes as TSV files (one per sequence also).
Therefore, the number of folders of images and TSV files should be the equal
to the number of considered typhoon sequences.</p>
<div class="section" id="generate-a-typhoonsequence-hdf-file">
<span id="id2"></span><h3>1.1 Generate a TyphoonSequence HDF File<a class="headerlink" href="#generate-a-typhoonsequence-hdf-file" title="Permalink to this headline">¶</a></h3>
<p>This library provides a set of tools to integrate both sources into
single HDF files. For this example, we assume the following paths for the
respective data sources.</p>
<ul class="simple">
<li><strong>Satellite images:</strong> Directory with all satellite imagery folders (one
per sequence), <code class="docutils literal notranslate"><span class="pre">../original_data/image/</span></code></li>
<li><strong>Best track data:</strong> Directory with a TSV file per sequence, <code class="docutils literal notranslate"><span class="pre">../original_data/jma/</span></code></li>
</ul>
<p>In the code example below, we generate three different datasets:</p>
<ul class="simple">
<li><strong>Original data:</strong> Sequences stored as single H5 files. Placed at <code class="docutils literal notranslate"><span class="pre">../data/sequences/compressed_1/</span></code></li>
<li><strong>Corrected data:</strong> Sequences stored as single H5 files with corrected
satellite imagery. Placed at <code class="docutils literal notranslate"><span class="pre">../data/sequences/corrected_1/</span></code></li>
<li><strong>Gapfilled data:</strong> Sequences stored as single H5 files with corrected
satellite imagery and image temporal gaps filled with synthetic frames.
Placed at <code class="docutils literal notranslate"><span class="pre">../data/sequences/gapfilled_1/</span></code></li>
</ul>
<p>We note that we store all the HDF generated files using compression.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># TODO: Refactor &amp; TEST</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;agg&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span><span class="p">,</span> <span class="n">isdir</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
<span class="kn">from</span> <span class="nn">pyphoon.io.typhoonlist</span> <span class="kn">import</span> <span class="n">create_typhoonlist_from_source</span>
<span class="kn">from</span> <span class="nn">pyphoon.clean_satellite.fix</span> <span class="kn">import</span> <span class="n">TyphoonListImageFixAlgorithm</span>
<span class="kn">from</span> <span class="nn">pyphoon.clean_satellite.detection</span> <span class="kn">import</span> <span class="n">detect_corrupted_pixels_1</span>
<span class="kn">from</span> <span class="nn">pyphoon.clean_satellite.correction</span> <span class="kn">import</span> <span class="n">correct_corrupted_pixels_1</span>
<span class="kn">from</span> <span class="nn">pyphoon.clean_satellite.generation</span> <span class="kn">import</span> <span class="n">generate_new_frames_1</span>
<span class="kn">import</span> <span class="nn">time</span>


<span class="c1"># Directories</span>
<span class="n">directory_images</span> <span class="o">=</span> <span class="s2">&quot;../original_data/image/&quot;</span>
<span class="n">directory_best</span> <span class="o">=</span> <span class="s2">&quot;../original_data/jma/&quot;</span>
<span class="c1"># Path destination</span>
<span class="n">path_normal</span> <span class="o">=</span> <span class="s1">&#39;../data/sequences/compressed_3/&#39;</span>
<span class="n">path_corrected</span> <span class="o">=</span> <span class="s1">&#39;../data/sequences/corrected_3/&#39;</span>
<span class="c1">#path_gapfilled = &#39;../data/sequences/gapfilled_3/&#39;</span>

<span class="c1"># Get typhoon image sequence folders.</span>
<span class="n">folders</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="n">directory_images</span><span class="p">)</span> <span class="k">if</span> <span class="n">isdir</span><span class="p">(</span><span class="n">join</span><span class="p">(</span>
    <span class="n">directory_images</span><span class="p">,</span> <span class="n">f</span><span class="p">))])</span>

<span class="c1"># Define correction algorithm</span>
<span class="n">correct_algorithm</span> <span class="o">=</span> <span class="n">TyphoonListImageFixAlgorithm</span><span class="p">(</span>
    <span class="n">detect_fct</span><span class="o">=</span><span class="n">detect_corrupted_pixels_1</span><span class="p">,</span>
    <span class="n">correct_fct</span><span class="o">=</span><span class="n">correct_corrupted_pixels_1</span><span class="p">,</span>
    <span class="n">detect_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;min_th&#39;</span><span class="p">:</span> <span class="mi">160</span><span class="p">,</span> <span class="s1">&#39;max_th&#39;</span><span class="p">:</span> <span class="mi">310</span><span class="p">},</span>
<span class="p">)</span>
<span class="c1"># Define generating algorithm</span>
<span class="n">generation_algorithm</span> <span class="o">=</span> <span class="n">TyphoonListImageFixAlgorithm</span><span class="p">(</span>
    <span class="n">fillgaps_fct</span><span class="o">=</span><span class="n">generate_new_frames_1</span><span class="p">,</span>
    <span class="n">n_frames_th</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>
<span class="c1"># Iterate over all folders</span>
<span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
    <span class="c1"># Get paths</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">folder</span><span class="o">+</span><span class="s2">&quot;.h5&quot;</span>
    <span class="n">path_images</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">directory_images</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
    <span class="n">path_best</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">directory_best</span><span class="p">,</span> <span class="n">folder</span><span class="o">+</span><span class="s1">&#39;.tsv&#39;</span><span class="p">)</span>

    <span class="c1"># User info</span>
    <span class="k">print</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot; source images:&quot;</span><span class="p">,</span> <span class="n">path_images</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot; source metadata:&quot;</span><span class="p">,</span> <span class="n">path_best</span><span class="p">)</span>

    <span class="c1"># Create and store TyphoonSequence</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">sequence</span> <span class="o">=</span> <span class="n">create_typhoonlist_from_source</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
        <span class="n">images</span><span class="o">=</span><span class="n">path_images</span><span class="p">,</span>
        <span class="n">best</span><span class="o">=</span><span class="n">path_best</span>
    <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot; H5 file created in&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="s2">&quot;sec&quot;</span><span class="p">)</span>

    <span class="c1"># Save original</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">sequence</span><span class="o">.</span><span class="n">save_as_h5</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">path_normal</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot; original stored in&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="s2">&quot;sec&quot;</span><span class="p">)</span>

    <span class="c1"># Save corrected</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">sequence</span> <span class="o">=</span> <span class="n">correct_algorithm</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="n">sequence</span><span class="o">.</span><span class="n">save_as_h5</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">path_corrected</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot; corrected stored in&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="s2">&quot;sec&quot;</span><span class="p">)</span>

    <span class="c1"># Save gapfilled</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">sequence</span> <span class="o">=</span> <span class="n">generation_algorithm</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="n">sequence</span><span class="o">.</span><span class="n">save_as_h5</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">path_gapfilled</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot; gap-filled stored in&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="s2">&quot;sec&quot;</span><span class="p">)</span>

    <span class="c1"># Clear ids info</span>
    <span class="n">correct_algorithm</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">generation_algorithm</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>We note that <code class="xref py py-func docutils literal notranslate"><span class="pre">save_as_h5()</span></code> has an
option to save the data in a compressed format.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="https://github.com/lucasrodes/pyphoon/tree/master/scripts/generate_hdf_files.py">script</a></p>
</div>
</div>
</div>
<div class="section" id="dataset-overview">
<span id="id3"></span><h2>2. Dataset overview<a class="headerlink" href="#dataset-overview" title="Permalink to this headline">¶</a></h2>
<p>Having a high-level overview of the dataset may provide interesting insights.</p>
<div class="section" id="mean-image">
<span id="id4"></span><h3>2.1 Mean image<a class="headerlink" href="#mean-image" title="Permalink to this headline">¶</a></h3>
<p>It is interesting to obtain the mean image of the image dataset. In large
datasets, like Digital Typhoon’s, loading all the data is not possible.
Hence, the mean image has to be sequentially obtained. We can easily obtain
the deviation image, the maximum value image and minimum value image as they
do not require much more additional computation.</p>
<p>For this example, we use the already generated datasets. In particular we
will use the corrected version, stored at <code class="docutils literal notranslate"><span class="pre">../data/sequences/corrected_1/</span></code>.</p>
<blockquote>
<div>The resulting images wil be stored at <code class="docutils literal notranslate"><span class="pre">../data/params/params_1</span></code>.</div></blockquote>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;agg&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">pyphoon.io</span> <span class="kn">import</span> <span class="n">load_typhoonlist_h5</span>
<span class="kn">from</span> <span class="nn">pyphoon.io.h5</span> <span class="kn">import</span> <span class="n">get_h5_filenames</span><span class="p">,</span> <span class="n">write_h5file</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>


<span class="c1"># Get filenames</span>
<span class="n">directory_images</span> <span class="o">=</span> <span class="s2">&quot;../data/sequences/corrected_1&quot;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">get_h5_filenames</span><span class="p">(</span><span class="n">directory_images</span><span class="p">)</span>

<span class="c1"># Parameters</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">mu2</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">c</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">maxv</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">minv</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Iterate over all HDF files</span>
<span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
    <span class="c1"># Load sequence</span>
    <span class="n">typhoon_sequence</span> <span class="o">=</span> <span class="n">load_typhoonlist_h5</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">directory_images</span><span class="p">,</span> <span class="nb">file</span><span class="p">))</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">typhoon_sequence</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>

    <span class="c1"># Sequentially update mean image</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mu2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="n">mu2</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">maxv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">maxv</span><span class="p">)</span>
    <span class="n">minv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">minv</span><span class="p">)</span>

<span class="c1"># Compute deviation image</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu2</span> <span class="o">-</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Store images</span>
<span class="n">write_h5file</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">std</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">maxv</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">minv</span><span class="p">},</span>
    <span class="n">path_to_file</span><span class="o">=</span><span class="s1">&#39;../data/params/params_0.h5&#39;</span><span class="p">,</span>
    <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span>
<span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="https://github.com/lucasrodes/pyphoon/tree/master/scripts/mean_image.py">script</a></p>
</div>
</div>
<div class="section" id="visualize-a-typhoonlist">
<span id="visualize-a-typhoonsequence"></span><h3>2.2 Visualize a TyphoonList<a class="headerlink" href="#visualize-a-typhoonlist" title="Permalink to this headline">¶</a></h3>
<p>Visualizing a sequence can be sometimes helpful. In the following example we
visualize the sequence <strong>197906</strong> stored at <code class="docutils literal notranslate"><span class="pre">../sampledata/197906.h5</span></code>.
However, note that this can be extended to any other typhoon sequence.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>
<span class="c1">#import matplotlib</span>
<span class="c1">#matplotlib.use(&#39;agg&#39;)</span>

<span class="kn">from</span> <span class="nn">pyphoon.io</span> <span class="kn">import</span> <span class="n">load_typhoonlist_h5</span>
<span class="kn">from</span> <span class="nn">pyphoon.utils</span> <span class="kn">import</span> <span class="n">DisplaySequence</span>

<span class="c1"># Load sequence</span>
<span class="n">sequence</span> <span class="o">=</span> <span class="n">load_typhoonlist_h5</span><span class="p">(</span><span class="s1">&#39;../sampledata/201725.h5&#39;</span><span class="p">)</span>

<span class="c1"># Create DisplaySequence instance and run</span>
<span class="n">DisplaySequence</span><span class="p">(</span>
    <span class="n">typhoon_sequence</span><span class="o">=</span><span class="n">sequence</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;201725&quot;</span><span class="p">,</span>
    <span class="n">interval</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="https://github.com/lucasrodes/pyphoon/tree/master/scripts/visualize_sequence.py">script</a>,
<a class="reference external" href="https://github.com/lucasrodes/pyphoon/tree/master/notebooks/Getting_Started.ipynb">notebook</a></p>
</div>
</div>
</div>
<div class="section" id="corrupted-files">
<span id="id7"></span><h2>3. Corrupted files<a class="headerlink" href="#corrupted-files" title="Permalink to this headline">¶</a></h2>
<p>Digital Typhoon is a project that aims to tackle a real-world issue. Hence,
it contains real-world data, which often contains some errors. Finding and
correcting those errors becomes essential so as to be able to rely on the
given data.</p>
<div class="section" id="corrupted-images">
<span id="id8"></span><h3>3.1 Corrupted images<a class="headerlink" href="#corrupted-images" title="Permalink to this headline">¶</a></h3>
<p>To find the corrupted files in our dataset, we employ the method
<code class="xref py py-func docutils literal notranslate"><span class="pre">find_corrupted_frames_1()</span></code>, which implements a
very simple approach for detecting possible corrupted pixels. For this
example, we use the data in <code class="docutils literal notranslate"><span class="pre">../data/sequences/compressed_1</span></code> as dataset and
store the images considered as <em>corrupted</em> at <code class="docutils literal notranslate"><span class="pre">../data/iter_n</span></code>.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">pyphoon.io.typhoonlist</span> <span class="kn">import</span> <span class="n">load_typhoonlist_h5</span>
<span class="kn">from</span> <span class="nn">pyphoon.io.h5</span> <span class="kn">import</span> <span class="n">get_h5_filenames</span>
<span class="kn">from</span> <span class="nn">pyphoon.clean_satellite</span> <span class="kn">import</span> <span class="n">find_corrupted_frames_1</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="c1"># Directories</span>
<span class="n">directory_files_0</span> <span class="o">=</span> <span class="s2">&quot;../data/sequences/compressed_1&quot;</span>
<span class="n">directory_corrupted_0</span> <span class="o">=</span> <span class="s2">&quot;../data/corrupted/iter_n&quot;</span>

<span class="c1"># Get H5 file names</span>
<span class="n">files_0</span> <span class="o">=</span> <span class="n">get_h5_filenames</span><span class="p">(</span><span class="n">directory_files_0</span><span class="p">)</span>

<span class="c1"># Iterate over all files in dataset</span>
<span class="n">corrupted_frames</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">file_0</span> <span class="ow">in</span> <span class="n">files_0</span><span class="p">:</span>

    <span class="c1"># Load sequence</span>
    <span class="n">path_file_0</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">directory_files_0</span><span class="p">,</span> <span class="n">file_0</span><span class="p">)</span>
    <span class="n">sequence</span> <span class="o">=</span> <span class="n">load_typhoonlist_h5</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">path_file_0</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file_0</span><span class="p">)</span>

    <span class="c1"># Get corrupted frame indices</span>
    <span class="n">_corrupted_frames</span><span class="p">,</span> <span class="n">_corrupted_info</span> <span class="o">=</span> <span class="n">find_corrupted_frames_1</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="n">corrupted_frames</span><span class="p">[</span><span class="n">sequence</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_corrupted_frames</span>

    <span class="c1">#  Save corrupted image frames as images</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">corrupted_frame</span><span class="p">,</span> <span class="n">frame_info</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_corrupted_frames</span><span class="p">,</span> <span class="n">_corrupted_info</span><span class="p">):</span>
        <span class="n">_info</span> <span class="o">=</span> <span class="s1">&#39; / &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">frame_info</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">frame_id</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">images_ids</span><span class="p">[</span><span class="n">corrupted_frame</span><span class="p">]</span>
        <span class="c1"># Clean plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sequence</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">corrupted_frame</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">frame_id</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">_info</span><span class="p">)</span>
        <span class="c1">#  Save image</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">directory_corrupted_0</span><span class="p">,</span> <span class="n">frame_id</span><span class="p">))</span>
        <span class="c1"># User info</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   [X] &quot;</span> <span class="o">+</span> <span class="n">frame_id</span> <span class="o">+</span> <span class="s2">&quot; corrupted -&quot;</span><span class="p">,</span> <span class="n">_info</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="s2">&quot;files corrupted&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;---------------&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="https://github.com/lucasrodes/pyphoon/tree/master/scripts/find_corrupted_images.py">script</a></p>
</div>
</div>
</div>
</div>

    

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Kitamoto Lab interns.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2018a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>