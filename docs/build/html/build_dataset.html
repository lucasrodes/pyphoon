
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Building the Dataset &#8212; pyphoon 2018a documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2018a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pyphoon 2018a documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="building-the-dataset">
<h1>Building the Dataset<a class="headerlink" href="#building-the-dataset" title="Permalink to this headline">¶</a></h1>
<p>In this project, we use <em>Digital Typhoon</em> data for different tasks. Below we
describe how we build the respective datasets for each task.</p>
<div class="section" id="tropical-cyclone-vs-extra-tropical-cyclone">
<h2>1. Tropical Cyclone vs. Extra-Tropical Cyclone<a class="headerlink" href="#tropical-cyclone-vs-extra-tropical-cyclone" title="Permalink to this headline">¶</a></h2>
<p>Typhoons are categorised in 5 different categories. On the one hand,
categories 2, 3, 4 and 5 refer to different intensity levels of Typhoons
(Tropical Cyclones). On the other hand, category 6 stands for another natural
phenomenon known as <em>Extra-Tropical Cyclone</em>. Details on the diferences
between both phenomena can be found <a class="reference external" href="http://www.aoml.noaa.gov/hrd/tcfaq/A7.html">here</a> and <a class="reference external" href="http://www.hko.gov.hk/education/edu01met/01met_tropical_cyclones/ele_typhoon3_e.htm">here</a>.</p>
<ul>
<li><p class="first"><strong>Generating the dataset</strong></p>
<p>For this task, we label tropical cyclones as 0 and extra-tropical
cyclones as 1. We note that from the original dataset, only 12% of the
data is extra-topical. Hence, using all the dataset would lead to a high
imbalance in the class category. To overcome this, we consider all
extra-TC samples but only a subset of TC samples, so as to have a 50/50
dataset.</p>
<p>The following script builds the dataset, assuming the typhoon sequences are
located at <code class="docutils literal"><span class="pre">../data/sequences/corrected_1/</span></code> it places the newly generated
dataset at <code class="docutils literal"><span class="pre">../data/datasets/task_1/original_512</span></code></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Script to build the dataset for task 1.</span>

<span class="sd">It takes 50/50 samples from TC class (categories 2,3,4,5) and Extra-TC class</span>
<span class="sd">(category 6). It ignores category 7.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;agg&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pyphoon.io</span> <span class="kn">import</span> <span class="n">read_typhoonlist_h5</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">pyphoon.io.h5</span> <span class="kn">import</span> <span class="n">write_h5file</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">shuffle</span>

<span class="n">path_to_folder</span> <span class="o">=</span> <span class="s1">&#39;../data/sequences/corrected_1/&#39;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">listdir</span><span class="p">(</span><span class="n">path_to_folder</span><span class="p">)</span>
<span class="n">shuffle</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_data_model_1</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Obtains an array of imag</span>

<span class="sd">    :param seq: Typhoon sequence</span>
<span class="sd">    :type seq: TyphoonList</span>
<span class="sd">    :return: Array of images, array of class, array of ids.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Resets parameters</span>
    <span class="n">im</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Find position samples for each class</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="n">seq</span><span class="o">.</span><span class="n">best</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="n">seq</span><span class="o">.</span><span class="n">best</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="n">seq</span><span class="o">.</span><span class="n">best</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s1">&#39;5&#39;</span><span class="p">:</span> <span class="n">seq</span><span class="o">.</span><span class="n">best</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s1">&#39;6&#39;</span><span class="p">:</span> <span class="n">seq</span><span class="o">.</span><span class="n">best</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span>
    <span class="p">}</span>
    <span class="n">n_6</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="s1">&#39;6&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># Get class-6 data</span>
    <span class="n">im</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="s1">&#39;6&#39;</span><span class="p">]])</span>
    <span class="n">bs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_6</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">ids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">images_ids</span><span class="p">)[</span><span class="n">idx</span><span class="p">[</span><span class="s1">&#39;6&#39;</span><span class="p">]]))</span>

    <span class="c1"># Get not-6 class data</span>
    <span class="n">_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_6</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_ratio</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">_ratio</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">]:</span>
        <span class="n">available_samples</span> <span class="o">=</span> <span class="n">seq</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_samples</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_samples</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">_ratio</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">)</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">ratio</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">im</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">available_samples</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
            <span class="n">bs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ratio</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">ids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">images_ids</span><span class="p">)[</span><span class="n">pos</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">im</span><span class="p">,</span> <span class="n">bs</span><span class="p">,</span> <span class="n">ids</span>


<span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">file_id</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">X</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">Y</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">1800</span>
<span class="n">path_to_dataset</span> <span class="o">=</span> <span class="s1">&#39;../data/datasets/task_1/original_512&#39;</span>

<span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">))</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="n">read_typhoonlist_h5</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_folder</span><span class="p">,</span> <span class="nb">file</span><span class="p">),</span> <span class="n">alignment</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">iim</span><span class="p">,</span> <span class="n">bbs</span><span class="p">,</span> <span class="n">iids</span> <span class="o">=</span> <span class="n">get_data_model_1</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>

    <span class="c1"># Update dataset blob</span>
    <span class="n">ids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">iids</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">iim</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bbs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">iim</span><span class="p">))</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">Y</span><span class="p">,</span> <span class="n">bbs</span><span class="p">))</span>

    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  &gt; read&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">iim</span><span class="p">),</span> <span class="s2">&quot;samples in&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="s2">&quot;sec</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Store dataset if size threshold exceeded</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">K</span><span class="p">:</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">X</span><span class="p">,</span>
            <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="n">Y</span><span class="p">,</span>
            <span class="s1">&#39;ids&#39;</span><span class="p">:</span> <span class="n">ids</span>
        <span class="p">}</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_id</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.h5&#39;</span>
        <span class="n">file_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">write_h5file</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">path_to_dataset</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;------------------------------------&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  [!] storing...&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">,</span> <span class="s2">&quot;sec&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  [!] number of samples:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;----------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Restore values</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Store remaining data</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">X</span><span class="p">,</span>
    <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="n">Y</span><span class="p">,</span>
    <span class="s1">&#39;ids&#39;</span><span class="p">:</span> <span class="n">ids</span>
<span class="p">}</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_id</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.h5&#39;</span>
<span class="n">file_id</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">write_h5file</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">path_to_dataset</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;------------------------------------&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;  [!] storing...&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">,</span> <span class="s2">&quot;sec&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;  [!] number of samples:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;----------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="https://github.com/lucasrodes/pyphoon/tree/master/scripts/build_dataset_1.py">script</a></p>
</div>
</li>
<li><p class="first"><strong>Scaling dataset</strong></p>
<p>To reduce the computational complexity of this task, we scale the images
from 512x512 to 256x256. As input it uses the files stored at <code class="docutils literal"><span class="pre">.</span>
<span class="pre">./data/datasets/task_1/original_512</span></code> and places the new scaled versions
at <code class="docutils literal"><span class="pre">../data/datasets/task_1/original_256</span></code></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Scales images from a dataset. Reducing the size of the images can decrease</span>
<span class="sd">the computational complexity.</span>

<span class="sd">It also obtains class distribution for each data blob</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;agg&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">pyphoon.io.h5</span> <span class="kn">import</span> <span class="n">read_h5file</span><span class="p">,</span> <span class="n">write_h5file</span>
<span class="kn">from</span> <span class="nn">skimage.transform</span> <span class="kn">import</span> <span class="n">downscale_local_mean</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="n">path_origin</span> <span class="o">=</span> <span class="s1">&#39;../data/datasets/task_1/original_512/&#39;</span>
<span class="n">path_destination</span> <span class="o">=</span> <span class="s1">&#39;../data/datasets/task_1/original_256/&#39;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">listdir</span><span class="p">(</span><span class="n">path_origin</span><span class="p">)</span>

<span class="n">stats</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">))</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># Get filename</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.h5&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Get data</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">read_h5file</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">path_origin</span><span class="p">,</span> <span class="nb">file</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  [!] resized in&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">,</span> <span class="s2">&quot;sec&quot;</span><span class="p">)</span>

    <span class="c1"># Resize data</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">downscale_local_mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]])</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  [!] resized in&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">,</span> <span class="s2">&quot;sec&quot;</span><span class="p">)</span>

    <span class="c1"># Save resized data</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">X</span><span class="p">,</span>
        <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span>
        <span class="s1">&#39;ids&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="n">write_h5file</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">path_destination</span><span class="p">,</span> <span class="nb">file</span><span class="p">),</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  [!] stored in&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">,</span> <span class="s2">&quot;sec&quot;</span><span class="p">)</span>

    <span class="c1"># Get statistics</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">class_distrib</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
    <span class="n">stats</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="n">v</span><span class="o">/</span><span class="n">n_samples</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">class_distrib</span><span class="p">}</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  [!] stats gotten in&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">,</span> <span class="s2">&quot;sec&quot;</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="s2">&quot;sec&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># Create DataFrame and save statistics</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../data/datasets/task_1/stats.csv&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="https://github.com/lucasrodes/pyphoon/tree/master/scripts/scale_256.py">script</a></p>
</div>
</li>
<li><p class="first"><strong>Normalizing dataset</strong></p>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Building the Dataset</a><ul>
<li><a class="reference internal" href="#tropical-cyclone-vs-extra-tropical-cyclone">1. Tropical Cyclone vs. Extra-Tropical Cyclone</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pyphoon 2018a documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Lucas Rodes-Guirao.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.6.
    </div>
  </body>
</html>