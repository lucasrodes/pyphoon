
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Setting up the environment &#8212; pyphoon 2018a documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2018a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pyphoon 2018a documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="setting-up-the-environment">
<span id="setting-up-the-environment"></span><h1>Setting up the environment<a class="headerlink" href="#setting-up-the-environment" title="Permalink to this headline">¶</a></h1>
<p>For this project, a docker container has been used. In particular, we used a
modified version of the docker <a class="reference external" href="https://github.com/ufoym/deepo">deepo</a>, which
provides a version with GPU support to most DL/ML frameworks.</p>
<div class="section" id="get-the-project-in-your-working-directory">
<span id="get-the-project-in-your-working-directory"></span><h2>Get the project in your working directory<a class="headerlink" href="#get-the-project-in-your-working-directory" title="Permalink to this headline">¶</a></h2>
<p>First of all, the project from GitHub should be retrieved. To accelerate the
work, some symbolic links are created</p>
<ul>
<li><p class="first"><strong>Clone the project from GitHub</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Create project folder</span>
<span class="n">mkdir</span> <span class="o">~/</span><span class="n">projects</span>
<span class="c1"># Clone pyphoon</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lucasrodes</span><span class="o">/</span><span class="n">pyphoon</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Create symbolic link to dataset paths</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Go to project workspace</span>
<span class="n">cd</span> <span class="n">pyphoon</span>
<span class="c1"># Symbolic link to data provided by Digital Typhoon</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">fs9</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">typhoon</span><span class="o">/</span><span class="n">wnp</span><span class="o">/</span> <span class="n">original_data</span>
<span class="c1"># Create directory where processed/cleaned data will be stored</span>
<span class="n">mkdir</span> <span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">fs9</span><span class="o">/&lt;</span><span class="n">user</span><span class="o">&gt;/</span><span class="n">data</span>
<span class="c1"># Symbolic link to the directory</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">fs9</span><span class="o">/&lt;</span><span class="n">user</span><span class="o">&gt;/</span><span class="n">data</span> <span class="n">data</span>
</pre></div>
</div>
<p>You might want to add <code class="docutils literal"><span class="pre">original_data</span></code> and <code class="docutils literal"><span class="pre">data</span></code> to your .gitignore.</p>
</li>
</ul>
</div>
<div class="section" id="pre-requisites">
<span id="pre-requisites"></span><h2>Pre-requisites<a class="headerlink" href="#pre-requisites" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first"><strong>Install <a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-centos-7">Docker</a></strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Update the package database:</span>
<span class="n">sudo</span> <span class="n">yum</span> <span class="n">check</span><span class="o">-</span><span class="n">update</span>
<span class="c1"># Add the official Docker repository, download the latest version of </span>
<span class="n">Docker</span><span class="p">,</span> <span class="ow">and</span> <span class="n">install</span> <span class="n">it</span><span class="p">:</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">fsSL</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">get</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="n">com</span><span class="o">/</span> <span class="o">|</span> <span class="n">sh</span>
<span class="c1"># Start Docker daemon:</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">docker</span>
<span class="c1"># Verify that it is running</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">status</span> <span class="n">docker</span>
<span class="c1"># Enable it auto-start at every server reboot</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">docker</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>GPU support: Install <a class="reference external" href="https://github.com/NVIDIA/nvidia-docker">nvidia-docker</a></strong></p>
<p>If your machine does not support GPU, ignore this step.</p>
<p>Make sure you have installed the <a class="reference external" href="https://github.com/NVIDIA/nvidia-docker/wiki/Frequently-Asked-Questions#how-do-i-install-the-nvidia-driver">NVIDIA driver</a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># If you have nvidia-docker 1.0 installed: we need to remove it and all existing GPU containers</span>
<span class="n">docker</span> <span class="n">volume</span> <span class="n">ls</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span><span class="n">f</span> <span class="n">driver</span><span class="o">=</span><span class="n">nvidia</span><span class="o">-</span><span class="n">docker</span> <span class="o">|</span> <span class="n">xargs</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">I</span><span class="p">{}</span> <span class="o">-</span><span class="n">n1</span> <span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">f</span> <span class="n">volume</span><span class="o">=</span><span class="p">{}</span> <span class="o">|</span> <span class="n">xargs</span> <span class="o">-</span><span class="n">r</span> <span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span>
<span class="n">sudo</span> <span class="n">yum</span> <span class="n">remove</span> <span class="n">nvidia</span><span class="o">-</span><span class="n">docker</span>

<span class="c1"># Add the package repositories</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">L</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">nvidia</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">nvidia</span><span class="o">-</span><span class="n">docker</span><span class="o">/</span><span class="n">centos7</span><span class="o">/</span><span class="n">x86_64</span><span class="o">/</span><span class="n">nvidia</span><span class="o">-</span><span class="n">docker</span><span class="o">.</span><span class="n">repo</span> <span class="o">|</span> \
  <span class="n">sudo</span> <span class="n">tee</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">yum</span><span class="o">.</span><span class="n">repos</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nvidia</span><span class="o">-</span><span class="n">docker</span><span class="o">.</span><span class="n">repo</span>

<span class="c1"># Install nvidia-docker2 and reload the Docker daemon configuration</span>
<span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">nvidia</span><span class="o">-</span><span class="n">docker2</span>
<span class="n">sudo</span> <span class="n">pkill</span> <span class="o">-</span><span class="n">SIGHUP</span> <span class="n">dockerd</span>

<span class="c1"># Test nvidia-smi with the latest official CUDA image</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">runtime</span><span class="o">=</span><span class="n">nvidia</span> <span class="o">--</span><span class="n">rm</span> <span class="n">nvidia</span><span class="o">/</span><span class="n">cuda</span> <span class="n">nvidia</span><span class="o">-</span><span class="n">smi</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="creating-our-docker-container">
<span id="creating-our-docker-container"></span><h2>Creating our Docker Container<a class="headerlink" href="#creating-our-docker-container" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first"><strong>Obtain the all-in-one image from <a class="reference external" href="https://hub.docker.com/r/ufoym/deepo">Docker Hub</a></strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">ufoym</span><span class="o">/</span><span class="n">deepo</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Modify image</strong></p>
<p>Create a Dockerfile</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">~/.</span><span class="n">docker_images</span><span class="o">/&lt;</span><span class="n">docker</span> <span class="n">image</span> <span class="n">folder</span> <span class="n">name</span><span class="o">&gt;</span>
<span class="n">vim</span> <span class="o">~/.</span><span class="n">docker_images</span><span class="o">/&lt;</span><span class="n">docker</span> <span class="n">image</span> <span class="n">folder</span> <span class="n">name</span><span class="o">&gt;/</span><span class="n">Dockerfile</span>
</pre></div>
</div>
<p>and add the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">FROM</span> <span class="n">ufoym</span><span class="o">/</span><span class="n">deepo</span>
<span class="n">RUN</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">plotly</span> <span class="n">moviepy</span> <span class="n">jupyter</span> <span class="n">notebook</span>
</pre></div>
</div>
<p>Save the file and build the docker image.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/.</span><span class="n">docker_images</span><span class="o">/&lt;</span><span class="n">docker</span> <span class="n">image</span> <span class="n">folder</span> <span class="n">name</span><span class="o">&gt;/</span>
<span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="o">&lt;</span><span class="n">your_name</span><span class="o">&gt;/</span><span class="n">deepo</span> <span class="o">.</span>
</pre></div>
</div>
<p><em>In the future we plan to generate the docker image and load to the Hub
so that other researchers can easily import it.</em></p>
</li>
<li><p class="first"><strong>Create a Docker container</strong></p>
<p>Finally, time to create a container of the Docker image. We will create
it with GPU name <code class="docutils literal"><span class="pre">dlnii</span></code> (short for deep learning NII).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvidia</span><span class="o">-</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> 
<span class="o">-</span><span class="n">p</span> <span class="mi">8888</span><span class="p">:</span><span class="mi">8888</span> \
<span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">fs9</span><span class="o">/&lt;</span><span class="n">user</span><span class="o">&gt;/</span><span class="p">:</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">storage</span> \
<span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">fs3</span><span class="o">/</span><span class="n">home</span><span class="o">/&lt;</span><span class="n">user</span><span class="o">&gt;/</span><span class="n">projects</span><span class="p">:</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">projects</span> \
<span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">fs9</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">typhoon</span><span class="o">/</span><span class="n">wnp</span><span class="o">/</span><span class="p">:</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">original_data</span> \
<span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">host</span><span class="o">/</span><span class="n">config</span><span class="p">:</span><span class="o">/</span><span class="n">config</span> \
<span class="o">--</span><span class="n">name</span> <span class="n">dlnii</span> \
<span class="o">&lt;</span><span class="n">your_name</span><span class="o">&gt;/</span><span class="n">deepo</span>  <span class="n">bash</span>
</pre></div>
</div>
<p>Let us explain below the different options used in the command above.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">-v</span></code>: Enable access from container to files in the host machine.
In our case, we will make the following files accessible:<ul>
<li><code class="docutils literal"><span class="pre">/misc/fs9/datasets/typhoon/wnp/</span></code> accessible from the container as
<code class="docutils literal"><span class="pre">/root/original_data</span></code>. This contains the typhoon data (images and best
track)</li>
<li><code class="docutils literal"><span class="pre">/misc/fs9/&lt;user&gt;/</span></code> accessible as <code class="docutils literal"><span class="pre">/root/storage</span></code>. This is the
directory in the server for <code class="docutils literal"><span class="pre">user</span></code> to store large files. This is where</li>
<li><code class="docutils literal"><span class="pre">/misc/fs3/home/&lt;user&gt;/projects</span></code> accessible from the container as
<code class="docutils literal"><span class="pre">root/projects</span></code>. Note that this assumes that you have a file <code class="docutils literal"><span class="pre">projects</span></code>
in your home directory.</li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">-p</span></code>: Port forwarding, this is done to access jupyter notebook running
from the virtual machine. In particular, we will forward port 8888 in the
virtual machine to port 8888 in the host machine.</li>
</ul>
<p><em>If your machine does not have GPU-support, run <code class="docutils literal"><span class="pre">docker</span></code> instead of
<code class="docutils literal"><span class="pre">nvidia-docker</span></code></em></p>
</li>
</ul>
</div>
<div class="section" id="create-and-start-docker-container">
<span id="create-and-start-docker-container"></span><h2>Create and start Docker container<a class="headerlink" href="#create-and-start-docker-container" title="Permalink to this headline">¶</a></h2>
<p>Finally, you can easily instantiate the docker container</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">start</span> <span class="n">dlnii</span>
</pre></div>
</div>
<p>Once started, to execute the instance just type</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">dlnii</span> <span class="n">bash</span>
</pre></div>
</div>
<p>To exit the container just type</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">exit</span>
</pre></div>
</div>
</div>
<div class="section" id="docker-in-jupyter-notebook">
<span id="docker-in-jupyter-notebook"></span><h2>Docker in Jupyter Notebook<a class="headerlink" href="#docker-in-jupyter-notebook" title="Permalink to this headline">¶</a></h2>
<p>Execute your docker container and run (inside the container):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">jupyter</span> <span class="n">notebook</span> <span class="o">--</span><span class="n">ip</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> <span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">root</span>
</pre></div>
</div>
<p>This will prompt with a link of format: <code class="docutils literal"><span class="pre">http://0.0.0.0:8888/?token=xxx</span></code>.
Keep the token (xxx). Now, navigate to <a class="reference external" href="localhost:8888">localhost:8888</a> in
your web browser in the host machine. Use the token as the password.</p>
<p>Create a notebook and start coding, it will run on the docker!</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Setting up the environment</a><ul>
<li><a class="reference internal" href="#get-the-project-in-your-working-directory">Get the project in your working directory</a></li>
<li><a class="reference internal" href="#pre-requisites">Pre-requisites</a></li>
<li><a class="reference internal" href="#creating-our-docker-container">Creating our Docker Container</a></li>
<li><a class="reference internal" href="#create-and-start-docker-container">Create and start Docker container</a></li>
<li><a class="reference internal" href="#docker-in-jupyter-notebook">Docker in Jupyter Notebook</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pyphoon 2018a documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Lucas Rodes-Guirao.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.6.
    </div>
  </body>
</html>